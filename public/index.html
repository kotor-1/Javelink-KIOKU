<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŠ KIOKU JAVELINK - ã‚¸ãƒ£ãƒ™å…¨ç¨®ç›®è§£æ</title>
    <link rel="icon" href="data:,">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+JP:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            overflow-x: hidden;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8E8 50%, #FFF8DC 100%);
            min-height: 100vh;
            position: relative;
        }
        
        /* å¤ªé™½ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .sun {
            position: fixed;
            top: 50px;
            right: 50px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50%;
            box-shadow: 0 0 50px #FFD700;
            animation: pulse 4s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .sun:hover {
            transform: scale(1.2) rotate(180deg);
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 50px #FFD700; }
            50% { box-shadow: 0 0 80px #FFA500; }
        }
        
        /* æ³¢ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .ocean {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(180deg, transparent, #1E90FF);
            z-index: 1;
        }
        
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%234A90E2' fill-opacity='0.8' d='M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,133.3C960,128,1056,96,1152,96C1248,96,1344,128,1392,144L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: 50% 100px;
            animation: wave 10s linear infinite;
            opacity: 0.8;
        }
        
        .wave:nth-child(2) {
            animation-delay: -5s;
            opacity: 0.6;
            bottom: 10px;
        }
        
        .wave:nth-child(3) {
            animation-delay: -2s;
            opacity: 0.4;
            bottom: 20px;
        }
        
        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* é›²ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .cloud {
            position: fixed;
            background: white;
            border-radius: 100px;
            opacity: 0.7;
            animation: float 20s infinite ease-in-out;
        }
        
        .cloud::before,
        .cloud::after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 100px;
        }
        
        .cloud1 {
            width: 100px;
            height: 40px;
            top: 20%;
            left: -100px;
            animation-duration: 25s;
        }
        
        .cloud1::before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 10px;
        }
        
        .cloud1::after {
            width: 60px;
            height: 40px;
            top: -15px;
            right: 10px;
        }
        
        .cloud2 {
            width: 80px;
            height: 35px;
            top: 40%;
            left: -80px;
            animation-duration: 30s;
            animation-delay: -10s;
        }
        
        @keyframes float {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(100vw + 200px)); }
        }
        
        /* ã‚¸ãƒ£ãƒ™ãƒªãƒƒã‚¯ç”¨å“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .javelin-item {
            position: fixed;
            animation: float-items 15s infinite ease-in-out;
            z-index: 5;
            cursor: pointer;
            transition: transform 0.3s;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
            display: block !important; /* ç¢ºå®Ÿã«è¡¨ç¤º */
            opacity: 1; /* é€æ˜åº¦ã‚’ç¢ºå®Ÿã«è¨­å®š */
        }
        
        .javelin-item:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 8px 20px rgba(0,0,0,0.4));
        }
        
        @keyframes float-items {
            0%, 100% { 
                transform: translateY(0) translateX(0);
            }
            25% { 
                transform: translateY(-20px) translateX(10px);
            }
            50% { 
                transform: translateY(10px) translateX(-10px);
            }
            75% { 
                transform: translateY(-15px) translateX(5px);
            }
        }
        
        /* ã‚«ãƒ¢ãƒ¡ */
        .seagull {
            position: fixed;
            top: 15%;
            animation: fly 15s infinite ease-in-out;
            font-size: 30px;
            transform: scaleX(-1);
        }
        
        @keyframes fly {
            0% { left: -50px; top: 15%; }
            25% { top: 10%; }
            50% { left: 100%; top: 20%; }
            75% { top: 12%; }
            100% { left: -50px; top: 15%; }
        }
        
        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }
        
        /* ã‚¿ã‚¤ãƒˆãƒ« */
        .title-container {
            text-align: center;
            margin-bottom: 3rem;
            animation: slideDown 1s ease-out;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .main-title {
            font-family: 'Bebas Neue', cursive;
            font-size: 4rem;
            background: linear-gradient(45deg, #FF6B35, #F7931E, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 0.5rem;
            letter-spacing: 3px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { filter: brightness(1); }
            to { filter: brightness(1.2); }
        }
        
        .subtitle {
            color: #2C3E50;
            font-size: 0.95rem;
            font-weight: 700;
        }
        
        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼/ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è£…é£¾ */
        .progress-slider {
            width: 100%;
            height: 4px;
            background: rgba(255, 107, 53, 0.2);
            border-radius: 2px;
            margin: 1rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .progress-slider::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 60%;
            background: linear-gradient(90deg, #FF6B35, #FFD700);
            border-radius: 2px;
            animation: slide-progress 3s ease-in-out infinite;
        }
        
        @keyframes slide-progress {
            0%, 100% { width: 20%; }
            50% { width: 80%; }
        }
        
        /* ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰å‹ã®ã‚«ãƒ¼ãƒ‰ */
        .surfboard-card {
            background: linear-gradient(135deg, #FFFAFA 0%, #F0FFFF 100%);
            border-radius: 150px 150px 30px 30px;
            padding: 3rem 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            animation: float-card 3s ease-in-out infinite;
            border: 3px solid #FFD700;
        }
        
        @keyframes float-card {
            0%, 100% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-10px) rotate(1deg); }
        }
        
        /* ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰ã®æ¨¡æ§˜ */
        .surfboard-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -50%;
            width: 200%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #FFD700, transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { left: -50%; }
            100% { left: 150%; }
        }
        
        /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
        .upload-zone {
            background: radial-gradient(circle at center, rgba(64, 224, 208, 0.1), rgba(30, 144, 255, 0.1));
            border: 3px dashed #40E0D0;
            border-radius: 30px;
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .upload-zone:hover {
            background: radial-gradient(circle at center, rgba(64, 224, 208, 0.2), rgba(30, 144, 255, 0.2));
            transform: scale(1.02);
            border-color: #FF6B35;
        }
        
        .upload-zone.dragover {
            background: radial-gradient(circle at center, rgba(255, 107, 53, 0.2), rgba(255, 215, 0, 0.2));
            border-color: #FF6B35;
            animation: pulse-border 1s infinite;
        }
        
        @keyframes pulse-border {
            0%, 100% { border-width: 3px; }
            50% { border-width: 5px; }
        }
        
        .upload-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .upload-text {
            font-size: 1.3rem;
            color: #2C3E50;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .upload-subtext {
            color: #5A6C7D;
            font-size: 0.9rem;
        }
        
        /* ãƒ“ãƒ‡ã‚ªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .video-container {
            display: none;
            position: relative;
            z-index: 50;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin: 2rem 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .video-container video {
            width: 100%;
            height: auto;
            aspect-ratio: 16/9;
            display: block;
            background: #000;
        }
        
        /* è§£æãƒœã‚¿ãƒ³ */
        .analyze-button {
            display: none;
            background: linear-gradient(135deg, #FF6B35, #FFD700);
            color: white;
            border: none;
            padding: 1.5rem 3rem;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 2rem auto;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .analyze-button:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 107, 53, 0.4);
        }
        
        .analyze-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .analyze-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .analyze-button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-container {
            display: none;
            margin: 2rem 0;
        }
        
        .progress-wave {
            height: 60px;
            background: #E8F4F8;
            border-radius: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #40E0D0, #4A90E2, #1E90FF);
            background-size: 200% 100%;
            animation: gradient 2s ease infinite;
            transition: width 0.3s;
            position: relative;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #2C3E50;
            font-weight: bold;
            font-size: 1.2rem;
            z-index: 10;
        }
        
        /* çµæœè¡¨ç¤º */
        .results-container {
            display: none;
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .results-title {
            text-align: center;
            font-size: 2rem;
            color: #FF6B35;
            margin-bottom: 2rem;
            font-weight: bold;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .result-item {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .result-item:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: #FFD700;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .result-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
        }
        
        .result-item:hover::before {
            animation: shimmer 0.5s;
        }
        
        @keyframes shimmer {
            0% { transform: rotate(45deg) translateY(-100%); }
            100% { transform: rotate(45deg) translateY(100%); }
        }
        
        .result-label {
            color: #5A6C7D;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        

        
        .result-value-unit {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
            margin: 0.5rem 0;
        }
        
        .result-value-unit .result-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FF6B35, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }
        
        .result-value-unit .result-unit {
            font-size: 1.5rem;
            font-weight: 600;
            color: #7F8C8D;
            margin: 0;
        }
        
        .result-description {
            color: #7F8C8D;
            font-size: 0.75rem;
            margin-top: 0.5rem;
            line-height: 1.3;
            text-align: center;
            font-style: italic;
        }
        

        
        /* è·é›¢å…¥åŠ› */
        .distance-section {
            background: linear-gradient(135deg, #FFF8DC, #F0FFFF);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .distance-label {
            display: block;
            color: #2C3E50;
            font-weight: bold;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .distance-input {
            width: 100%;
            padding: 1rem;
            font-size: 1.5rem;
            border: 2px solid #40E0D0;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s;
            background: white;
        }
        
        .distance-input:focus {
            outline: none;
            border-color: #FF6B35;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.2);
            transform: scale(1.02);
        }
        
        /* ãƒ“ãƒ¼ãƒãƒœãƒ¼ãƒ«è£…é£¾ */
        .beach-ball {
            position: fixed;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #FF6B35 0deg 60deg,
                white 60deg 120deg,
                #40E0D0 120deg 180deg,
                white 180deg 240deg,
                #FFD700 240deg 300deg,
                white 300deg 360deg
            );
            animation: roll 20s linear infinite;
            cursor: pointer;
        }
        
        .beach-ball1 {
            bottom: 100px;
            left: 10%;
            animation-delay: 0s;
        }
        
        .beach-ball2 {
            bottom: 150px;
            right: 15%;
            animation-delay: -10s;
        }
        
        @keyframes roll {
            0% {
                transform: translateX(0) rotate(0deg);
            }
            100% {
                transform: translateX(100px) rotate(360deg);
            }
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .main-title {
                font-size: 3rem;
            }
            
            .surfboard-card {
                padding: 2rem 1rem;
                border-radius: 50px 50px 20px 20px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* éš ã—è¦ç´  */
        input[type="file"] {
            display: none;
        }
        
        canvas {
            display: none;
        }

        /* å‹•ç”»æœ€é©åŒ–æƒ…å ± */
        .optimization-info {
            background: linear-gradient(135deg, #F0F8FF 0%, #E6F3FF 100%);
            border: 2px solid #40E0D0;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            animation: slideDown 0.5s ease-out;
        }
        
        .optimization-header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .optimization-icon {
            font-size: 2rem;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }
        
        .optimization-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2C3E50;
        }
        
        .optimization-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.8rem;
            text-align: left;
        }
        
        .optimization-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(64, 224, 208, 0.3);
        }
        
        .label {
            font-size: 0.9rem;
            color: #5A6C7D;
            font-weight: 600;
        }
        
        .value {
            font-size: 1.1rem;
            font-weight: bold;
            color: #FF6B35;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .special-note {
            background: linear-gradient(135deg, #FFF8DC, #FFE4B5);
            border: 2px solid #FFD700;
        }
        
        .special-note .value {
            color: #FF8C00;
            font-weight: bold;
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒãƒ¼ */
        .loading-progress {
            width: 100%;
            height: 8px;
            background: rgba(64, 224, 208, 0.2);
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #40E0D0, #4A90E2, #1E90FF);
            background-size: 200% 100%;
            animation: loading-animation 2s ease-in-out infinite;
            width: 100%;
        }
        
        @keyframes loading-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* ========== ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ï¼ˆâ‰¤430pxï¼‰ ========== */
        @media (max-width: 430px) {
            :root { 
                --pad: 12px; 
                --gap: 10px; 
                --radius: 12px; 
            }
            
            body { 
                padding: var(--pad); 
                font-size: clamp(12px, 3.5vw, 14px);
            }
            
            /* ã‚¿ã‚¤ãƒˆãƒ«ã¯2è¡Œã¾ã§è¨±å®¹ï¼ˆPCæº–æ‹ ï¼‰ */
            .title-container { 
                margin: 8px 0 10px; 
                text-align: center;
            }
            
            .main-title { 
                font-size: clamp(18px, 5.2vw, 22px); 
                letter-spacing: 1px; 
                margin: 0; 
                line-height: 1.2;
            }
            
            .subtitle { 
                display: block; 
                font-size: clamp(12px, 3.4vw, 14px); 
                margin-top: 4px;
            }
            
            /* èƒŒæ™¯æ¼”å‡ºã¯è»½é‡åŒ–ï¼šæµ·/é›²ã¯éè¡¨ç¤ºã§ã‚‚OKã ãŒã€ç«¶æŠ€SVGã¯è¡¨ç¤º */
            .sun, .cloud, .ocean, .wave, .seagull { 
                display: none !important; 
            }
            
            /* ãƒ“ãƒ¼ãƒãƒœãƒ¼ãƒ«ã¯è¡¨ç¤º */
            .beach-ball { 
                display: block !important; 
                animation: none !important;
                opacity: 0.8;
            }
            
            /* ç«¶æŠ€SVGã¯è¡¨ç¤ºï¼ˆé™æ­¢æ¨å¥¨ï¼‰ */
            .javelin-item { 
                display: block !important; 
                animation: none !important; 
                z-index: 3; 
                opacity: 0.9;
                position: fixed !important;
                visibility: visible !important;
            }
            
            .javelin-ball, .turbo-jav, .javelin-spear { 
                display: block !important; 
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            /* ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚«ãƒ¼ãƒ‰ */
            .surfboard-card { 
                padding: 12px; 
                border-radius: 12px; 
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                margin: 0;
            }
            
            /* ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¾ãƒ¼ãƒ³ */
            .upload-zone { 
                padding: 18px 12px; 
                border-radius: var(--radius); 
                margin: var(--gap) 0;
            }
            
            /* å‹•ç”»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
            .video-container { 
                display: block; 
                background: #000; 
                border-radius: 8px; 
                overflow: hidden; 
                margin: var(--gap) 0;
            }
            
            .video-container video { 
                width: 100%; 
                height: auto; 
                aspect-ratio: 16/9; 
                max-height: min(36vh, 240px); 
                border-radius: 0;
            }
            
            /* èº«é•·å…¥åŠ›ï¼ˆãƒ¢ãƒã‚¤ãƒ«ã§ã¯éè¡¨ç¤ºï¼‰ */
            .height-input-row { 
                display: none; 
            }
            
            /* è¨­å®šãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šï¼‰ */
            .settings-trigger { 
                position: absolute; 
                top: 6px; 
                right: 6px; 
                font-size: 18px; 
                background: rgba(255,255,255,0.9);
                border-radius: 50%;
                width: 32px;
                height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                z-index: 10;
            }
            
            /* è§£æãƒœã‚¿ãƒ³ */
            .analyze-button { 
                width: 100%; 
                height: 44px; 
                padding: 0 12px; 
                border-radius: 999px; 
                font-size: 14px; 
                margin: var(--gap) 0; 
                min-height: 36px;
            }
            
            /* ãƒ¡ãƒ¼ã‚¿ãƒ¼ */
            #meters { 
                display: grid; 
                gap: 6px; 
                margin: var(--gap) 0;
            }
            
            #meters .bar { 
                height: 10px; 
                border-radius: 999px; 
                overflow: hidden; 
                background: #E9EEF5; 
            }
            
            #meters .fill { 
                height: 100%; 
                width: 0%; 
                background: linear-gradient(90deg, #41DAB5, #4AA3FF); 
                transition: width 0.3s ease;
            }
            
            /* çµæœã¯2åˆ—ä»¥ä¸Š */
            .results-container { 
                margin-top: var(--gap); 
            }
            
            .results-title { 
                font-size: clamp(16px, 4.5vw, 18px);
                margin-bottom: var(--gap);
            }
            
            .results-grid {
                display: grid;
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 10px;
                margin: var(--gap) 0; 
                padding: 0;
            }
            
            .result-item {
                border-radius: 12px; 
                padding: 10px; 
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                background: #fff;
                border: 1px solid #E5E7EB;
            }
            
            .result-label { 
                font-size: clamp(12px, 3.3vw, 14px); 
                color: #374151; 
                margin-bottom: 4px;
            }
            
            .result-value-unit .result-value { 
                font-size: clamp(18px, 5vw, 22px); 
                font-weight: 700; 
                background: none; 
                -webkit-text-fill-color: currentColor; 
                color: #2C3E50;
            }
            
            .result-value-unit .result-unit { 
                font-size: clamp(12px, 3.3vw, 13px); 
                color: #6B7280; 
            }
            
            /* èª¬æ˜ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºï¼ˆçœç•¥ã—ãªã„ï¼‰ */
            .result-description, .result-desc { 
                display: block; 
                font-size: clamp(11px, 3.1vw, 13px); 
                color: #6B7280; 
                margin-top: 4px; 
                line-height: 1.3;
            }
            
            /* è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« */
            .settings-modal { 
                display: none; 
                position: fixed; 
                top: 0; 
                left: 0; 
                width: 100%; 
                height: 100%; 
                background: rgba(0,0,0,0.5); 
                z-index: 1000;
            }
            
            .settings-modal.show { 
                display: flex; 
                align-items: center; 
                justify-content: center; 
            }
            
            .settings-content { 
                background: white; 
                border-radius: 12px; 
                padding: 16px; 
                width: 92vw; 
                max-width: 360px; 
                max-height: 80vh; 
                overflow-y: auto;
            }
            
            .settings-header { 
                display: flex; 
                justify-content: space-between; 
                align-items: center; 
                margin-bottom: 16px; 
                padding-bottom: 8px; 
                border-bottom: 1px solid #E5E7EB;
            }
            
            .settings-close { 
                background: none; 
                border: none; 
                font-size: 20px; 
                cursor: pointer; 
                color: #6B7280;
            }
            
            /* å…¥åŠ›ã®ã‚ºãƒ¼ãƒ æŠ‘æ­¢ */
            #userHeight, input[type="number"], input[type="text"] {
                font-size: 16px;
                padding: 10px 12px;
                line-height: 1.2;
            }
        }
        
        /* ãƒ¬ã‚¤ãƒ¤é †ã®èª¿æ•´ï¼ˆPC/ãƒ¢ãƒã‚¤ãƒ«å…±é€šï¼‰ */
        .sun, .cloud, .ocean, .wave, .seagull { z-index: 1; }
        .javelin-item { z-index: 3; }
        .video-container, .surfboard-card, .results-container, .analyze-button { position: relative; z-index: 5; }
        
        /* ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ºãƒ¼ãƒ é˜²æ­¢ */
        html { -webkit-text-size-adjust: 100%; }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯è£…é£¾ -->
    <div class="sun" onclick="toggleTheme()"></div>
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <div class="seagull">ğŸ¦…</div>
    
    <!-- æ³¢ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="ocean">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
    
    <!-- ã‚¸ãƒ£ãƒ™ãƒªãƒƒã‚¯ç”¨å“ -->
    <svg class="javelin-item javelin-ball" title="ã‚¸ãƒ£ãƒ™ãƒªãƒƒã‚¯ãƒœãƒ¼ãƒ«" viewBox="0 0 150 100" style="width: 100px; height: 67px; top: 25%; left: 10%;">
        <!-- ã‚¸ãƒ£ãƒ™ãƒªãƒƒã‚¯ãƒœãƒ¼ãƒ«æœ¬ä½“ -->
        <defs>
            <linearGradient id="bodyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#FFFFFF;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#F5F5F5;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#E0E0E0;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="tailFinGradient">
                <stop offset="0%" style="stop-color:#FF0000;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#DC143C;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#B22222;stop-opacity:1" />
            </linearGradient>
        </defs>
        
        <!-- èµ¤ã„å°¾ç¿¼ï¼ˆæ”¾å°„çŠ¶ã®3æšç¾½æ ¹ï¼‰ -->
        <!-- ä¸Šã®ç¾½æ ¹ -->
        <path d="M 40 50 L 15 50 L 10 35 L 15 40 L 35 48 Z" fill="url(#tailFinGradient)" />
        <!-- ä¸‹ã®ç¾½æ ¹ -->
        <path d="M 40 50 L 15 50 L 10 65 L 15 60 L 35 52 Z" fill="url(#tailFinGradient)" />
        <!-- æ¨ªã®ç¾½æ ¹ï¼ˆå´é¢ï¼‰ -->
        <path d="M 40 50 L 15 50 L 12 45 L 12 55 L 15 50 Z" fill="#DC143C" opacity="0.8"/>
        
        <!-- ç¾½æ ¹ã®æ¥ç¶šéƒ¨ -->
        <rect x="35" y="45" width="10" height="10" rx="2" fill="#B22222"/>
        
        <!-- ç™½ã„ãƒœãƒ‡ã‚£ï¼ˆãƒ­ã‚±ãƒƒãƒˆå‹ï¼‰ -->
        <!-- ãƒ¡ã‚¤ãƒ³ãƒœãƒ‡ã‚£ -->
        <ellipse cx="75" cy="50" rx="40" ry="18" fill="url(#bodyGradient)"/>
        <!-- å…ˆç«¯éƒ¨åˆ†ï¼ˆå°–ã£ãŸå½¢ï¼‰ -->
        <path d="M 115 50 Q 125 50, 135 50 L 115 42 L 115 58 Z" fill="#F0F0F0"/>
        
        <!-- ãƒœãƒ‡ã‚£ã®ãƒªãƒ³ã‚°æ¨¡æ§˜ï¼ˆæºï¼‰ -->
        <rect x="55" y="38" width="2" height="24" rx="1" fill="#D0D0D0" opacity="0.5"/>
        <rect x="62" y="38" width="2" height="24" rx="1" fill="#D0D0D0" opacity="0.5"/>
        <rect x="69" y="38" width="2" height="24" rx="1" fill="#D0D0D0" opacity="0.5"/>
        <rect x="76" y="38" width="2" height="24" rx="1" fill="#D0D0D0" opacity="0.5"/>
        <rect x="83" y="38" width="2" height="24" rx="1" fill="#D0D0D0" opacity="0.5"/>
        
        <!-- èµ¤ã„å††å½¢ãƒãƒ¼ã‚¯ï¼ˆä¸¡ã‚µã‚¤ãƒ‰ï¼‰ -->
        <ellipse cx="95" cy="50" rx="7" ry="5" fill="#FF0000" opacity="0.9"/>
        <ellipse cx="60" cy="50" rx="7" ry="5" fill="#FF0000" opacity="0.9"/>
        
        <!-- Javeball ãƒ­ã‚´ -->
        <text x="75" y="53" font-family="Arial Black" font-size="7" fill="#FF0000" text-anchor="middle" font-style="italic" font-weight="bold">JaveBall</text>
        
        <!-- ãƒã‚¤ãƒ©ã‚¤ãƒˆ -->
        <ellipse cx="65" cy="43" rx="12" ry="4" fill="white" opacity="0.6"/>
    </svg>
    
    <svg class="javelin-item turbo-jav" title="ã‚¿ãƒ¼ãƒœã‚¸ãƒ£ãƒ–" viewBox="0 0 300 60" style="width: 180px; height: 36px; top: 35%; right: 15%; transform: rotate(-30deg);">
        <!-- ã‚¿ãƒ¼ãƒœã‚¸ãƒ£ãƒ–æœ¬ä½“ -->
        <defs>
            <linearGradient id="turboGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#FF6B6B;stop-opacity:1" />
                <stop offset="20%" style="stop-color:#4ECDC4;stop-opacity:1" />
                <stop offset="40%" style="stop-color:#45B7D1;stop-opacity:1" />
                <stop offset="60%" style="stop-color:#96CEB4;stop-opacity:1" />
                <stop offset="80%" style="stop-color:#FFEAA7;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#DDA15E;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="tipGradient">
                <stop offset="0%" style="stop-color:#B0B0B0;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#808080;stop-opacity:1" />
            </linearGradient>
        </defs>
        <!-- ãƒ¡ã‚¤ãƒ³ãƒœãƒ‡ã‚£ -->
        <rect x="30" y="20" width="220" height="20" rx="10" fill="url(#turboGradient)"/>
        <!-- å…ˆç«¯ï¼ˆé‡‘å±éƒ¨åˆ†ï¼‰ -->
        <polygon points="250,30 280,30 290,25 290,35 280,30" fill="url(#tipGradient)"/>
        <!-- å¾Œç«¯ï¼ˆã‚°ãƒªãƒƒãƒ—ï¼‰ -->
        <rect x="10" y="22" width="25" height="16" rx="8" fill="#333333"/>
        <rect x="15" y="25" width="5" height="10" fill="#FF6B6B"/>
        <rect x="22" y="25" width="5" height="10" fill="#4ECDC4"/>
        <!-- ãƒ†ã‚­ã‚¹ãƒˆ -->
        <text x="140" y="35" font-family="Arial Black" font-size="12" fill="white" text-anchor="middle">TURBO</text>
    </svg>
    
    <svg class="javelin-item javelin-spear" title="ã‚„ã‚ŠæŠ•ã’" viewBox="0 0 400 40" style="width: 200px; height: 20px; top: 20%; left: 50%; transform: rotate(45deg);">
        <!-- ã‚„ã‚ŠæŠ•ã’ç”¨ã‚„ã‚Š -->
        <defs>
            <linearGradient id="spearShaft" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#C0C0C0;stop-opacity:1" />
                <stop offset="10%" style="stop-color:#E8E8E8;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#FFFFFF;stop-opacity:1" />
                <stop offset="90%" style="stop-color:#E8E8E8;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#C0C0C0;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="spearTip">
                <stop offset="0%" style="stop-color:#808080;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#A0A0A0;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#606060;stop-opacity:1" />
            </linearGradient>
        </defs>
        <!-- ã‚·ãƒ£ãƒ•ãƒˆ -->
        <rect x="40" y="17" width="300" height="6" fill="url(#spearShaft)"/>
        <!-- ã‚°ãƒªãƒƒãƒ—ã‚³ãƒ¼ãƒ‰ï¼ˆå·»ãä»˜ã‘éƒ¨åˆ†ï¼‰ -->
        <rect x="160" y="16" width="60" height="8" fill="#2C3E50"/>
        <rect x="165" y="16" width="3" height="8" fill="#E74C3C"/>
        <rect x="172" y="16" width="3" height="8" fill="#E74C3C"/>
        <rect x="179" y="16" width="3" height="8" fill="#E74C3C"/>
        <rect x="186" y="16" width="3" height="8" fill="#E74C3C"/>
        <rect x="193" y="16" width="3" height="8" fill="#E74C3C"/>
        <rect x="200" y="16" width="3" height="8" fill="#E74C3C"/>
        <rect x="207" y="16" width="3" height="8" fill="#E74C3C"/>
        <rect x="214" y="16" width="3" height="8" fill="#E74C3C"/>
        <!-- å…ˆç«¯ -->
        <polygon points="340,20 380,20 390,18 395,20 390,22 380,20 340,20" fill="url(#spearTip)"/>
        <!-- å¾Œç«¯ -->
        <ellipse cx="40" cy="20" rx="8" ry="6" fill="#808080"/>
    </svg>
    
    <div class="beach-ball beach-ball1"></div>
    <div class="beach-ball beach-ball2"></div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="container">
        <div class="title-container">
            <h1 class="main-title">ğŸŒŠ KIOKU JAVELINK</h1>
            <p class="subtitle">ã‚¸ãƒ£ãƒ™å…¨ç¨®ç›®è§£æ - æ¹˜å—ã‚¹ã‚¿ã‚¤ãƒ«</p>
            <div class="progress-slider"></div>
        </div>
        
        <div class="surfboard-card">
            <!-- è¨­å®šãƒœã‚¿ãƒ³ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰ -->
            <div class="settings-trigger" id="settingsTrigger" style="display: none;">âš™</div>
            
            <!-- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">ğŸ¥</div>
                <p class="upload-text">æŠ•æ“²å‹•ç”»ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ï¼</p>
                <p class="upload-subtext">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ (MP4, MOV, AVI, WebM)</p>
                <input type="file" id="videoFile" accept="video/*">
            </div>
            
            <!-- èº«é•·å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div id="heightInputRow" style="display:block; margin:10px 0; padding:15px; background:#FFF8DC; border-radius:8px; border:2px solid #FFD700;">
                <div style="font-weight:700; color:#2C3E50; margin-bottom:10px;">ğŸ“ èº«é•·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆã‚ˆã‚Šæ­£ç¢ºãªæ¸¬å®šã®ãŸã‚ï¼‰</div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <label style="color:#2C3E50; font-weight:bold;">èº«é•·(cm)ï¼š</label>
                    <input type="number" id="userHeight" step="1" value="140" inputmode="numeric" style="width:6rem; padding:8px; border:2px solid #FFD700; border-radius:5px; text-align:center;">
                    <button id="saveHeightBtn" style="padding:8px 15px; background:#FFD700; border:none; border-radius:5px; color:#2C3E50; font-weight:bold; cursor:pointer;">ä¿å­˜</button>
                </div>
                <div style="font-size:0.8em; color:#5A6C7D; margin-top:5px;">èº«é•·ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€æŠ•ã’å‡ºã—é«˜ã•ãŒcmå˜ä½ã§æ­£ç¢ºã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
            </div>
            
            <!-- å‹•ç”»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div class="video-container" id="videoContainer" style="display: none;">
                <video id="videoPreview" controls style="width: 100%; height: auto; border-radius: 8px;">
                    ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯å‹•ç”»å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
                </video>
            </div>
            
            <!-- å‹•ç”»æƒ…å ±è¡¨ç¤º -->
            <div id="videoInfoRow" style="display:none; margin:10px 0; padding:10px; background:#F0F8FF; border-radius:8px; border:1px solid #40E0D0;">
                <div style="font-weight:700; color:#2C3E50; margin-bottom:5px;">ğŸ“¹ å‹•ç”»æƒ…å ±</div>
                <div id="videoInfoText" style="font-size:0.9em; color:#5A6C7D;"></div>
            </div>
            
            <!-- è§£æãƒœã‚¿ãƒ³ -->
            <button class="analyze-button" id="analyzeBtn" style="display: none;">
                ğŸš€ è§£æã‚¹ã‚¿ãƒ¼ãƒˆï¼
            </button>
            
            <!-- ãƒ¡ãƒ¼ã‚¿ãƒ¼è¡¨ç¤ºï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰ -->
            <div id="meters" style="display: none;">
                <div class="bar">
                    <div class="fill" id="meterFill"></div>
                </div>
                <div style="text-align: center; font-size: 12px; color: #6B7280;">
                    <span id="meterText">æº–å‚™ä¸­...</span>
                </div>
            </div>
            
            <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-wave">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    <div class="progress-text" id="progressText">è§£æä¸­... 0%</div>
                </div>
            </div>
            
            <!-- çµæœè¡¨ç¤º -->
            <div class="results-container" id="resultsContainer">
                <h3 class="results-title">ğŸ¯ è§£æå®Œäº†ï¼</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <div>
                            <div class="result-label">æŠ•ã’å‡ºã—è§’åº¦</div>
                            <div class="result-value-unit">
                                <span class="result-value" id="releaseAngle">--</span>
                                <span class="result-unit">Â°</span>
                            </div>
                        </div>
                        <small class="result-desc">æŠ•ã’ã‚‹ç¬é–“ã®æ‰‹ã®è§’åº¦ã€‚30-45åº¦ãŒè‰¯ã„ã¨ã•ã‚Œã¦ã„ã¾ã™</small>
                    </div>
                    <div class="result-item">
                        <div>
                            <div class="result-label">æŠ•ã’å‡ºã—é«˜ã•</div>
                            <div class="result-value-unit">
                                <span class="result-value" id="releaseHeight">--</span>
                                <span class="result-unit">cm</span>
                            </div>
                        </div>
                        <small class="result-desc">æŠ•ã’ã‚‹ç¬é–“ã®æ‰‹ã®é«˜ã•ã€‚èº«é•·ã«æ¯”ä¾‹ã—ã¾ã™</small>
                    </div>
                    <div class="result-item">
                        <div>
                            <div class="result-label">æŠ•ã’ã‚‹å‹•ä½œã®æ™‚é–“</div>
                            <div class="result-value-unit">
                                <span class="result-value" id="plantToRelease">--</span>
                                <span class="result-unit">s</span>
                            </div>
                        </div>
                        <small class="result-desc">æŠ•ã’å§‹ã‚ã‹ã‚‰æŠ•ã’çµ‚ã‚ã‚Šã¾ã§ã®æ™‚é–“</small>
                    </div>
                    <div class="result-item">
                        <div>
                            <div class="result-label">æŠ•ã’å‡ºã—é€Ÿåº¦</div>
                            <div class="result-value-unit">
                                <span class="result-value" id="releaseSpeed">--</span>
                                <span class="result-unit">m/s</span>
                            </div>
                        </div>
                        <small class="result-desc">æŠ•ã’ã‚‹ç¬é–“ã®æ‰‹ã®é€Ÿã•ã€‚é€Ÿã„ã»ã©é ãã«é£›ã³ã¾ã™</small>
                    </div>
                    <div class="result-item">
                        <div>
                            <div class="result-label">ä½“ã®ã­ã˜ã‚Œè§’åº¦</div>
                            <div class="result-value-unit">
                                <span class="result-value" id="shoulderHipSeparation">--</span>
                                <span class="result-unit">Â°</span>
                            </div>
                        </div>
                        <small class="result-desc">è‚©ã¨è…°ã®ã­ã˜ã‚Œå…·åˆã€‚é©åº¦ãªã­ã˜ã‚ŒãŒé‡è¦ã§ã™</small>
                    </div>
                </div>
                
                <!-- æŠ•æ“²è·é›¢å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ -->
            </div>
        </div>
    </div>
    
    <!-- éš ã—Canvas -->
    <canvas id="analysisCanvas"></canvas>
    
    <!-- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰ -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <h3>è¨­å®š</h3>
                <button class="settings-close" id="settingsClose">&times;</button>
            </div>
            <div class="height-input-row">
                <div style="font-weight:700; color:#2C3E50; margin-bottom:10px;">ğŸ“ èº«é•·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆã‚ˆã‚Šæ­£ç¢ºãªæ¸¬å®šã®ãŸã‚ï¼‰</div>
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
                    <label style="color:#2C3E50; font-weight:bold;">èº«é•·(cm)ï¼š</label>
                    <input type="number" id="userHeight" step="1" value="140" inputmode="numeric" style="width:6rem; padding:8px; border:2px solid #FFD700; border-radius:5px; text-align:center;">
                    <button id="saveHeightBtn" style="padding:8px 16px; background:#FF6B35; color:white; border:none; border-radius:5px; cursor:pointer;">ä¿å­˜</button>
                </div>
                <div style="font-size:0.8em; color:#5A6C7D; margin-top:5px;">èº«é•·ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€æŠ•ã’å‡ºã—é«˜ã•ãŒcmå˜ä½ã§æ­£ç¢ºã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
            </div>
        </div>
    </div>
    
    <script>
        // Video Analyzer Class
        class VideoAnalyzer {
            constructor() {
                this.video = null;
                this.canvas = null;
                this.ctx = null;
                this.analyzing = false;
                this.optimizedCanvas = null;
                this.optimizedCtx = null;
                this.optimizationRatio = 1.0;
            }
            
            async loadVideo(file) {
                return new Promise((resolve, reject) => {
                    const video = document.getElementById('videoPreview');
                    const url = URL.createObjectURL(file);
                    
                    // å‹•ç”»ã®èª­ã¿è¾¼ã¿çŠ¶æ…‹ã‚’è¿½è·¡
                    let metadataLoaded = false;
                    let dataLoaded = false;
                    let canPlay = false;
                    let sizeRetrieved = false;
                    
                    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
                    const timeout = setTimeout(() => {
                        reject(new Error('å‹•ç”»ã®èª­ã¿è¾¼ã¿ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ˆ30ç§’ï¼‰'));
                    }, 30000);
                    
                    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†
                    video.onloadedmetadata = () => {
                        console.log('ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', {
                            width: video.videoWidth,
                            height: video.videoHeight,
                            duration: video.duration
                        });
                        metadataLoaded = true;
                        checkReady();
                    };
                    
                    // å‹•ç”»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†
                    video.onloadeddata = () => {
                        console.log('å‹•ç”»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', {
                            width: video.videoWidth,
                            height: video.videoHeight,
                            readyState: video.readyState
                        });
                        dataLoaded = true;
                        checkReady();
                    };
                    
                    // å†ç”Ÿå¯èƒ½çŠ¶æ…‹
                    video.oncanplay = () => {
                        console.log('å†ç”Ÿå¯èƒ½çŠ¶æ…‹:', {
                            width: video.videoWidth,
                            height: video.videoHeight,
                            readyState: video.readyState
                        });
                        canPlay = true;
                        checkReady();
                    };
                    
                    // ã‚µã‚¤ã‚ºå–å¾—ã®è©¦è¡Œ
                    const tryGetSize = () => {
                        if (video.videoWidth > 0 && video.videoHeight > 0) {
                            sizeRetrieved = true;
                            console.log('ã‚µã‚¤ã‚ºå–å¾—æˆåŠŸ:', {
                                width: video.videoWidth,
                                height: video.videoHeight
                            });
                            checkReady();
                        } else {
                            // ä»£æ›¿æ–¹æ³•ã§ã‚µã‚¤ã‚ºã‚’å–å¾—
                            const tempCanvas = document.createElement('canvas');
                            const tempCtx = tempCanvas.getContext('2d');
                            
                            try {
                                // å‹•ç”»ã‚’ä¸€æ™‚çš„ã«æç”»ã—ã¦ã‚µã‚¤ã‚ºã‚’å–å¾—
                                tempCanvas.width = 1;
                                tempCanvas.height = 1;
                                tempCtx.drawImage(video, 0, 0, 1, 1);
                                
                                // å‹•ç”»ã®è‡ªç„¶ãªã‚µã‚¤ã‚ºã‚’å–å¾—
                                const naturalWidth = video.naturalWidth || video.videoWidth;
                                const naturalHeight = video.naturalHeight || video.videoHeight;
                                
                                if (naturalWidth > 0 && naturalHeight > 0) {
                                    // å‹•ç”»è¦ç´ ã®ã‚µã‚¤ã‚ºã‚’å¼·åˆ¶çš„ã«è¨­å®š
                                    video.style.width = naturalWidth + 'px';
                                    video.style.height = naturalHeight + 'px';
                                    
                                    // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç›´æ¥è¨­å®š
                                    Object.defineProperty(video, 'videoWidth', {
                                        value: naturalWidth,
                                        writable: false
                                    });
                                    Object.defineProperty(video, 'videoHeight', {
                                        value: naturalHeight,
                                        writable: false
                                    });
                                    
                                    sizeRetrieved = true;
                                    console.log('ä»£æ›¿æ–¹æ³•ã§ã‚µã‚¤ã‚ºå–å¾—æˆåŠŸ:', {
                                        width: naturalWidth,
                                        height: naturalHeight
                                    });
                                    checkReady();
                                } else {
                                    // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ¨æ¸¬ï¼ˆMOVãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆï¼‰
                                    if (file.name.toLowerCase().includes('.mov')) {
                                        console.log('MOVãƒ•ã‚¡ã‚¤ãƒ«æ¤œå‡ºã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚ºã‚’ä½¿ç”¨');
                                        // MOVãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€èˆ¬çš„ãªã‚µã‚¤ã‚ºã‚’è¨­å®š
                                        const defaultWidth = 1920;
                                        const defaultHeight = 1080;
                                        
                                        Object.defineProperty(video, 'videoWidth', {
                                            value: defaultWidth,
                                            writable: false
                                        });
                                        Object.defineProperty(video, 'videoHeight', {
                                            value: defaultHeight,
                                            writable: false
                                        });
                                        
                                        sizeRetrieved = true;
                                        console.log('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚ºè¨­å®š:', {
                                            width: defaultWidth,
                                            height: defaultHeight
                                        });
                                        checkReady();
                                    }
                                }
                            } catch (e) {
                                console.log('ä»£æ›¿ã‚µã‚¤ã‚ºå–å¾—å¤±æ•—:', e);
                            }
                        }
                    };
                    
                    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
                    video.onerror = (e) => {
                        console.error('å‹•ç”»èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                        clearTimeout(timeout);
                        reject(new Error('å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'));
                    };
                    
                    // æº–å‚™å®Œäº†ãƒã‚§ãƒƒã‚¯
                    const checkReady = () => {
                        if (metadataLoaded && dataLoaded && canPlay && sizeRetrieved) {
                            clearTimeout(timeout);
                            console.log('å‹•ç”»æº–å‚™å®Œäº† - æœ€çµ‚ç¢ºèª:', {
                                width: video.videoWidth,
                                height: video.videoHeight,
                                duration: video.duration,
                                readyState: video.readyState
                            });
                            
                            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰è¨­å®š
                            setTimeout(() => {
                                this.setupVideo(video, resolve, reject);
                            }, 100);
                        }
                    };
                    
                    // å‹•ç”»ã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹
                    video.src = url;
                    video.load(); // æ˜ç¤ºçš„ã«èª­ã¿è¾¼ã¿é–‹å§‹
                    
                    // ã‚µã‚¤ã‚ºå–å¾—ã‚’å®šæœŸçš„ã«è©¦è¡Œ
                    const sizeCheckInterval = setInterval(() => {
                        if (sizeRetrieved) {
                            clearInterval(sizeCheckInterval);
                            return;
                        }
                        tryGetSize();
                    }, 500);
                    
                    // 10ç§’å¾Œã«ã‚µã‚¤ã‚ºå–å¾—ã‚’å¼·åˆ¶å®Ÿè¡Œ
                    setTimeout(() => {
                        if (!sizeRetrieved) {
                            console.log('å¼·åˆ¶ã‚µã‚¤ã‚ºå–å¾—å®Ÿè¡Œ');
                            tryGetSize();
                        }
                    }, 10000);
                });
            }
            
            setupVideo(video, resolve, reject) {
                console.log('setupVideoé–‹å§‹:', {
                    videoWidth: video.videoWidth,
                    videoHeight: video.videoHeight,
                    readyState: video.readyState,
                    duration: video.duration
                });
                
                // å‹•ç”»ã®ã‚µã‚¤ã‚ºã‚’å†ç¢ºèª
                if (video.videoWidth === 0 || video.videoHeight === 0) {
                    console.error('å‹•ç”»ã‚µã‚¤ã‚ºãŒç„¡åŠ¹:', {
                        width: video.videoWidth,
                        height: video.videoHeight
                    });
                    
                    // MOVãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚ºã‚’è¨­å®š
                    if (video.src && video.src.includes('.mov')) {
                        console.log('MOVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚ºã‚’è¨­å®š');
                        const defaultWidth = 1920;
                        const defaultHeight = 1080;
                        
                        // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç›´æ¥è¨­å®š
                        Object.defineProperty(video, 'videoWidth', {
                            value: defaultWidth,
                            writable: false
                        });
                        Object.defineProperty(video, 'videoHeight', {
                            value: defaultHeight,
                            writable: false
                        });
                        
                        console.log('MOVãƒ•ã‚¡ã‚¤ãƒ«ç”¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚ºè¨­å®šå®Œäº†:', {
                            width: defaultWidth,
                            height: defaultHeight
                        });
                    } else {
                        reject(new Error(`å‹•ç”»ã®ã‚µã‚¤ã‚ºãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆwidth: ${video.videoWidth}, height: ${video.videoHeight}ï¼‰`));
                        return;
                    }
                }
                
                // å‹•ç”»ã®æº–å‚™çŠ¶æ…‹ã‚’ç¢ºèª
                if (video.readyState < 2) {
                    console.error('å‹•ç”»ã®æº–å‚™çŠ¶æ…‹ãŒä¸ååˆ†:', {
                        readyState: video.readyState,
                        networkState: video.networkState
                    });
                    reject(new Error('å‹•ç”»ã®æº–å‚™ãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚'));
                    return;
                }
                
                this.video = video;
                this.canvas = document.getElementById('analysisCanvas');
                
                // Canvasã®ã‚µã‚¤ã‚ºã‚’å‹•ç”»ã®ã‚µã‚¤ã‚ºã«è¨­å®š
                this.canvas.width = video.videoWidth;
                this.canvas.height = video.videoHeight;
                
                // Canvasã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—
                this.ctx = this.canvas.getContext('2d');
                
                // æœ€é©åŒ–ç”¨ã®Canvasã‚’ä½œæˆ
                this.createOptimizedCanvas();
                
                console.log('å‹•ç”»è¨­å®šå®Œäº†:', {
                    width: video.videoWidth,
                    height: video.videoHeight,
                    duration: video.duration,
                    canvasWidth: this.canvas.width,
                    canvasHeight: this.canvas.height,
                    optimizedWidth: this.optimizedCanvas.width,
                    optimizedHeight: this.optimizedCanvas.height,
                    optimizationRatio: this.optimizationRatio
                });
                
                resolve();
            }
            
            createOptimizedCanvas() {
                const originalWidth = this.video.videoWidth;
                const originalHeight = this.video.videoHeight;
                
                // è§£æã«æœ€é©ãªã‚µã‚¤ã‚ºã‚’è¨ˆç®—
                let targetWidth, targetHeight;
                
                if (originalWidth > 1920 || originalHeight > 1080) {
                    // 4Kä»¥ä¸Šã®å‹•ç”»ã¯1080pã«ç¸®å°
                    if (originalWidth > originalHeight) {
                        targetWidth = 1920;
                        targetHeight = Math.round((1920 * originalHeight) / originalWidth);
                    } else {
                        targetHeight = 1080;
                        targetWidth = Math.round((1080 * originalWidth) / originalHeight);
                    }
                } else if (originalWidth > 1280 || originalHeight > 720) {
                    // ãƒ•ãƒ«HDä»¥ä¸Šã®å‹•ç”»ã¯720pã«ç¸®å°
                    if (originalWidth > originalHeight) {
                        targetWidth = 1280;
                        targetHeight = Math.round((1280 * originalHeight) / originalWidth);
                    } else {
                        targetHeight = 720;
                        targetWidth = Math.round((720 * originalWidth) / originalHeight);
                    }
                } else {
                    // ãã‚Œä»¥ä¸‹ã®å‹•ç”»ã¯ãã®ã¾ã¾
                    targetWidth = originalWidth;
                    targetHeight = originalHeight;
                }
                
                // æœ€é©åŒ–æ¯”ç‡ã‚’è¨ˆç®—
                this.optimizationRatio = targetWidth / originalWidth;
                
                // æœ€é©åŒ–ç”¨Canvasã‚’ä½œæˆ
                this.optimizedCanvas = document.createElement('canvas');
                this.optimizedCanvas.width = targetWidth;
                this.optimizedCanvas.height = targetHeight;
                this.optimizedCtx = this.optimizedCanvas.getContext('2d');
                
                console.log('å‹•ç”»æœ€é©åŒ–è¨­å®š:', {
                    original: `${originalWidth}x${originalHeight}`,
                    optimized: `${targetWidth}x${targetHeight}`,
                    ratio: this.optimizationRatio.toFixed(3),
                    reduction: `${((1 - this.optimizationRatio) * 100).toFixed(1)}%`
                });
            }
            
            async analyze(progressCallback) {
                if (!this.video || this.analyzing) return null;
                
                // å‹•ç”»ã¨Canvasã®ã‚µã‚¤ã‚ºã‚’å†ç¢ºèª
                if (this.video.videoWidth === 0 || this.video.videoHeight === 0) {
                    throw new Error('å‹•ç”»ã®ã‚µã‚¤ã‚ºãŒå–å¾—ã§ãã¾ã›ã‚“ã€‚å‹•ç”»ã®èª­ã¿è¾¼ã¿ã‚’å®Œäº†ã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                }
                
                if (this.canvas.width === 0 || this.canvas.height === 0) {
                    // Canvasã®ã‚µã‚¤ã‚ºã‚’å†è¨­å®š
                    this.canvas.width = this.video.videoWidth;
                    this.canvas.height = this.video.videoHeight;
                    console.log('Canvasã‚µã‚¤ã‚ºã‚’å†è¨­å®š:', {
                        width: this.canvas.width,
                        height: this.canvas.height
                    });
                }
                
                console.log('è§£æé–‹å§‹ - å‹•ç”»æƒ…å ±:', {
                    duration: this.video.duration,
                    width: this.video.videoWidth,
                    height: this.video.videoHeight,
                    canvasWidth: this.canvas.width,
                    canvasHeight: this.canvas.height,
                    optimizedWidth: this.optimizedCanvas.width,
                    optimizedHeight: this.optimizedCanvas.height,
                    optimizationRatio: this.optimizationRatio
                });
                
                this.analyzing = true;
                const fps = 30;
                const duration = Math.min(this.video.duration, 10); // æœ€å¤§10ç§’ã«æ‹¡å¼µ
                const totalFrames = duration * fps;
                const frameSkip = 2; // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚¹ã‚­ãƒƒãƒ—ã‚’æ¸›ã‚‰ã—ã¦ç²¾åº¦å‘ä¸Š
                
                const motionData = {
                    positions: [],
                    heights: [],
                    timestamps: [],
                    motionAreas: []
                };
                
                this.video.currentTime = 0;
                let backgroundFrame = null;
                let frameCount = 0;
                
                try {
                    for (let i = 0; i < totalFrames; i += frameSkip) {
                        if (!this.analyzing) break;
                        
                        this.video.currentTime = i / fps;
                        await this.waitForFrame();
                        
                        // å‹•ç”»ã‚’Canvasã«æç”»
                        this.ctx.drawImage(this.video, 0, 0);
                        
                        // Canvasã®ã‚µã‚¤ã‚ºã‚’å†ç¢ºèª
                        if (this.canvas.width === 0 || this.canvas.height === 0) {
                            throw new Error('Canvasã®ã‚µã‚¤ã‚ºãŒç„¡åŠ¹ã§ã™');
                        }
                        
                        // æœ€é©åŒ–ã•ã‚ŒãŸCanvasã«ãƒªã‚µã‚¤ã‚ºã—ã¦æç”»
                        this.optimizedCtx.drawImage(
                            this.canvas, 
                            0, 0, this.canvas.width, this.canvas.height,
                            0, 0, this.optimizedCanvas.width, this.optimizedCanvas.height
                        );
                        
                        // è§£æãƒ«ãƒ¼ãƒ—å´ã®0ã‚µã‚¤ã‚ºä¿é™ºï¼ˆgetImageDataå‰ã«å¿…ãšãƒã‚§ãƒƒã‚¯ï¼‰
                        if (!this.optimizedCanvas.width || !this.optimizedCanvas.height) {
                            console.warn('skip frame: canvas size is 0'); 
                            continue; // ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é£›ã°ã™
                        }
                        
                        // æœ€é©åŒ–ã•ã‚ŒãŸCanvasã‹ã‚‰ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                        const imageData = this.optimizedCtx.getImageData(0, 0, this.optimizedCanvas.width, this.optimizedCanvas.height);
                        
                        if (!backgroundFrame) {
                            backgroundFrame = imageData;
                            console.log('èƒŒæ™¯ãƒ•ãƒ¬ãƒ¼ãƒ è¨­å®šå®Œäº†ï¼ˆæœ€é©åŒ–æ¸ˆã¿ï¼‰');
                        } else {
                            const motion = this.detectMotion(imageData, backgroundFrame);
                            if (motion) {
                                // æœ€é©åŒ–ã•ã‚ŒãŸåº§æ¨™ã‚’å…ƒã®åº§æ¨™ç³»ã«å¤‰æ›
                                const originalPosition = {
                                    x: motion.center.x / this.optimizationRatio,
                                    y: motion.center.y / this.optimizationRatio
                                };
                                const originalTopPoint = {
                                    x: motion.topPoint.x / this.optimizationRatio,
                                    y: motion.topPoint.y / this.optimizationRatio
                                };
                                
                                motionData.positions.push(originalPosition);
                                motionData.heights.push(originalTopPoint);
                                motionData.timestamps.push(i / fps);
                                motionData.motionAreas.push(motion.area);
                                frameCount++;
                            }
                        }
                        
                        if (progressCallback) {
                            const progress = Math.round((i / totalFrames) * 100);
                            progressCallback(progress);
                        }
                    }
                    
                    console.log('è§£æå®Œäº† - æ¤œå‡ºãƒ•ãƒ¬ãƒ¼ãƒ æ•°:', frameCount);
                    console.log('å‹•ããƒ‡ãƒ¼ã‚¿:', motionData);
                    
                } catch (error) {
                    console.error('è§£æä¸­ã®ã‚¨ãƒ©ãƒ¼:', error);
                    throw error;
                } finally {
                    this.analyzing = false;
                }
                
                return this.calculateMetrics(motionData);
            }
            
            waitForFrame() {
                return new Promise(resolve => {
                    requestAnimationFrame(() => {
                        setTimeout(resolve, 50);
                    });
                });
            }
            
            detectMotion(currentFrame, backgroundFrame) {
                const width = this.optimizedCanvas.width;
                const height = this.optimizedCanvas.height;
                const current = currentFrame.data;
                const background = backgroundFrame.data;
                
                let minX = width, maxX = 0;
                let minY = height, maxY = 0;
                let pixelCount = 0;
                let totalDiff = 0;
                
                // æœ€é©åŒ–ã•ã‚ŒãŸã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦ã‚¹ã‚­ãƒ£ãƒ³é–“éš”ã‚’èª¿æ•´
                const scanInterval = width > 1280 ? 3 : 2;
                
                // ã‚ˆã‚Šç´°ã‹ã„ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆæœ€é©åŒ–ã•ã‚ŒãŸã‚µã‚¤ã‚ºã«å¿œã˜ã¦èª¿æ•´ï¼‰
                for (let y = 0; y < height; y += scanInterval) {
                    for (let x = 0; x < width; x += scanInterval) {
                        const idx = (y * width + x) * 4;
                        
                        // RGBã®å·®åˆ†ã‚’è¨ˆç®—
                        const diffR = Math.abs(current[idx] - background[idx]);
                        const diffG = Math.abs(current[idx + 1] - background[idx + 1]);
                        const diffB = Math.abs(current[idx + 2] - background[idx + 2]);
                        
                        // æœ€é©åŒ–ã•ã‚ŒãŸã‚µã‚¤ã‚ºã«å¿œã˜ã¦é–¾å€¤ã‚’èª¿æ•´
                        const threshold = width > 1280 ? 40 : 50;
                        const diff = diffR + diffG + diffB;
                        
                        if (diff > threshold) {
                            minX = Math.min(minX, x);
                            maxX = Math.max(maxX, x);
                            minY = Math.min(minY, y);
                            maxY = Math.max(maxY, y);
                            pixelCount++;
                            totalDiff += diff;
                        }
                    }
                }
                
                // å‹•ãã®å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆæœ€é©åŒ–ã•ã‚ŒãŸã‚µã‚¤ã‚ºã«å¿œã˜ã¦èª¿æ•´ï¼‰
                const area = (maxX - minX) * (maxY - minY);
                const avgDiff = totalDiff / pixelCount;
                
                // æœ€é©åŒ–ã•ã‚ŒãŸã‚µã‚¤ã‚ºã«å¿œã˜ã¦æ¡ä»¶ã‚’èª¿æ•´
                const minArea = width > 1280 ? 800 : 1000;
                const minPixels = width > 1280 ? 80 : 100;
                const minDiff = width > 1280 ? 25 : 30;
                
                console.log('å‹•ãæ¤œå‡ºï¼ˆæœ€é©åŒ–æ¸ˆã¿ï¼‰:', {
                    area: area,
                    pixelCount: pixelCount,
                    avgDiff: Math.round(avgDiff),
                    bounds: { minX, maxX, minY, maxY },
                    scanInterval: scanInterval,
                    threshold: width > 1280 ? 40 : 50
                });
                
                // ã‚ˆã‚Šå³å¯†ãªæ¡ä»¶
                if (area < minArea || pixelCount < minPixels || avgDiff < minDiff) {
                    return null;
                }
                
                return {
                    center: { x: (minX + maxX) / 2, y: (minY + maxY) / 2 },
                    topPoint: { x: (minX + maxX) / 2, y: minY },
                    area: area,
                    quality: avgDiff
                };
            }
            
            calculateMetrics(motionData) {
                console.log('ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨ˆç®—é–‹å§‹:', motionData);
                
                if (motionData.positions.length < 5) {
                    console.error('å‹•ããƒ‡ãƒ¼ã‚¿ãŒä¸è¶³:', motionData.positions.length);
                    return null;
                }
                
                const positions = motionData.positions;
                const heights = motionData.heights;
                const areas = motionData.motionAreas;
                
                // æŠ•æ“²å‹•ä½œã®ç‰¹å¾´ã‚’åˆ†æ
                const maxAreaIndex = areas.indexOf(Math.max(...areas));
                const minHeightIndex = heights.indexOf(Math.min(...heights, h => h.y));
                
                console.log('æŠ•æ“²å‹•ä½œåˆ†æ:', {
                    maxAreaIndex: maxAreaIndex,
                    minHeightIndex: minHeightIndex,
                    maxArea: areas[maxAreaIndex],
                    minHeight: heights[minHeightIndex]
                });
                
                // ã‚ˆã‚Šå®Ÿç”¨çš„ãªè¨ˆç®—
                const releaseIndex = Math.min(maxAreaIndex + 2, positions.length - 1);
                const plantIndex = Math.max(0, maxAreaIndex - 2);
                
                // ãƒªãƒªãƒ¼ã‚¹è§’åº¦ã®è¨ˆç®—ï¼ˆæ”¹å–„ç‰ˆï¼‰
                const dx = heights[releaseIndex].x - positions[releaseIndex].x;
                const dy = heights[releaseIndex].y - positions[releaseIndex].y;
                const angle = Math.atan2(-dy, dx) * 180 / Math.PI;
                
                // ãƒªãƒªãƒ¼ã‚¹é«˜ã•ã®è¨ˆç®—ï¼ˆç”»é¢ã®ä¸‹ã‹ã‚‰ã®ç›¸å¯¾ä½ç½®ï¼‰
                const releaseHeight = (this.canvas.height - heights[releaseIndex].y) / this.canvas.height * 100;
                
                // å‹•ä½œæ™‚é–“ã®è¨ˆç®—
                const motionTime = motionData.timestamps[releaseIndex] - motionData.timestamps[plantIndex];
                
                // æŠ•æ“²ã®å“è³ªè©•ä¾¡
                const quality = this.evaluateThrowQuality(motionData);
                
                const result = {
                    releaseAngle: Math.abs(Math.round(angle)),
                    releaseHeight: Math.round(releaseHeight),
                    motionTime: Math.round(motionTime * 100) / 100,
                    quality: quality,
                    frameCount: positions.length
                };
                
                console.log('è¨ˆç®—çµæœ:', result);
                return result;
            }
            
            evaluateThrowQuality(motionData) {
                const areas = motionData.motionAreas;
                const avgArea = areas.reduce((a, b) => a + b, 0) / areas.length;
                const maxArea = Math.max(...areas);
                
                // å‹•ãã®ä¸€è²«æ€§ã‚’è©•ä¾¡
                let consistency = 0;
                for (let i = 1; i < areas.length; i++) {
                    const change = Math.abs(areas[i] - areas[i-1]) / avgArea;
                    if (change < 0.3) consistency++;
                }
                
                const consistencyScore = (consistency / (areas.length - 1)) * 100;
                
                if (consistencyScore > 80 && maxArea > 5000) return 'Excellent';
                if (consistencyScore > 60 && maxArea > 3000) return 'Good';
                if (consistencyScore > 40 && maxArea > 1000) return 'Fair';
                return 'Poor';
            }
        }
        
        // Initialize
        const analyzer = new VideoAnalyzer();
        
        // Event Listeners
        const uploadZone = document.getElementById('uploadZone');
        const videoFile = document.getElementById('videoFile');
        const videoContainer = document.getElementById('videoContainer');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const progressContainer = document.getElementById('progressContainer');
        const resultsContainer = document.getElementById('resultsContainer');
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®šã‚’ç¢ºå®Ÿã«ã™ã‚‹
        function setupEventListeners() {
            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šé–‹å§‹');
            
            // Upload handling
            if (uploadZone) {
                uploadZone.addEventListener('click', () => videoFile.click());
                
                uploadZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadZone.classList.add('dragover');
                });
                
                uploadZone.addEventListener('dragleave', () => {
                    uploadZone.classList.remove('dragover');
                });
                
                uploadZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadZone.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) handleVideoSelect(files[0]);
                });
            }
            
            if (videoFile) {
                videoFile.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        handleVideoSelect(e.target.files[0]);
                    }
                });
            }
            
            // Analysis button event listener
            if (analyzeBtn) {
                console.log('è§£æãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š');
                analyzeBtn.addEventListener('click', async () => {
                    console.log('=== è§£æé–‹å§‹ ===');
                    
                    try {
                        // èº«é•·ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                        if (!userHeight || userHeight < 100) {
                            alert('å…ˆã«èº«é•·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼');
                            return;
                        }
                        
                        // å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                        const videoFile = document.getElementById('videoFile');
                        if (!videoFile.files || videoFile.files.length === 0) {
                            alert('å…ˆã«å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼');
                            return;
                        }
                        
                        const file = videoFile.files[0];
                        console.log('è§£æå¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:', {
                            name: file.name,
                            size: file.size,
                            type: file.type
                        });
                        
                        // è§£æãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                        analyzeBtn.disabled = true;
                        analyzeBtn.textContent = 'è§£æä¸­...';
                        
                        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤º
                        progressContainer.style.display = 'block';
                        resultsContainer.style.display = 'none';
                        
                        console.log('è§£æå‡¦ç†é–‹å§‹...');
                        
                        // ç°¡å˜ãªè§£æå‡¦ç†ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
                        console.log('simpleAnalysisé–¢æ•°ã‚’å‘¼ã³å‡ºã—...');
                        const result = await simpleAnalysis(file);
                        console.log('simpleAnalysisçµæœ:', result);
                        
                        if (result) {
                            // çµæœè¡¨ç¤º
                            document.getElementById('releaseAngle').textContent = result.releaseAngleDeg;
                            document.getElementById('releaseHeight').textContent = result.releaseHeightCm;
                            document.getElementById('plantToRelease').textContent = result.plantToRelease;
                            document.getElementById('releaseSpeed').textContent = result.releaseSpeedMS;
                            document.getElementById('shoulderHipSeparation').textContent = result.sepDeg;
                            
                            // çµæœã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
                            window.lastResult = result;
                            
                            progressContainer.style.display = 'none';
                            resultsContainer.style.display = 'block';
                            
                            console.log('è§£æå®Œäº†:', result);
                            alert('æŠ•æ“²å‹•ä½œã®è§£æãŒå®Œäº†ã—ã¾ã—ãŸï¼ğŸ¯\n\næŠ•ã’æ–¹ã®ãƒã‚¤ãƒ³ãƒˆãŒåˆ†ã‹ã‚Šã¾ã—ãŸï¼');
                        } else {
                            alert('è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚å‹•ç”»ã®å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                        }
                        
                    } catch (error) {
                        console.error('è§£æã‚¨ãƒ©ãƒ¼:', error);
                        alert('è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                    } finally {
                        // è§£æãƒœã‚¿ãƒ³ã‚’å¾©æ´»
                        analyzeBtn.disabled = false;
                        analyzeBtn.textContent = 'ğŸš€ è§£æã‚¹ã‚¿ãƒ¼ãƒˆï¼';
                        console.log('è§£æå‡¦ç†çµ‚äº†');
                    }
                });
            } else {
                console.error('è§£æãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');
        }
        
        // DOMèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupEventListeners);
        } else {
            setupEventListeners();
        }
        
        // åˆæœŸè¡¨ç¤ºæ™‚ã«ç›®æ¨™å€¤ã‚’è¨­å®š
        function initializeGoals() {
            const h = userHeight;
            const tg = targetsFor(h);
            
            // ç›®æ¨™è¡¨è¨˜ã‚’åˆæœŸè¨­å®š
            setGoal('goalAngle',  `ç›®æ¨™: ${tg.angle[0]}â€“${tg.angle[1]}Â°`);
            setGoal('goalHeight', `ç›®æ¨™: ${tg.height[0].toFixed(0)}â€“${tg.height[1].toFixed(0)} cm`);
            setGoal('goalSpeed',  `ç›®æ¨™: ${tg.speed[0].toFixed(1)}â€“${tg.speed[1].toFixed(1)} m/s`);
            setGoal('goalSep',    `ç›®æ¨™: ${tg.sep[0]}â€“${tg.sep[1]}Â°`);
        }
        
        // åˆæœŸåŒ–å®Œäº†å¾Œã«ç›®æ¨™å€¤ã‚’è¨­å®š
        setTimeout(initializeGoals, 100);
        
        // ========== ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªå‹•ç”»å‡¦ç† ==========
        async function handleVideoSelect(file) {
            console.log('=== å‹•ç”»å‡¦ç†é–‹å§‹ ===');
            console.log('ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±:', {
                name: file.name,
                size: file.size,
                type: file.type,
                lastModified: file.lastModified
            });
            
            try {
                // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
                if (file.size > 100 * 1024 * 1024) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™ ğŸš«\n\nç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«: ' + (file.size / (1024 * 1024)).toFixed(1) + 'MB\næ¨å¥¨ã‚µã‚¤ã‚º: 100MBä»¥ä¸‹');
                    return;
                }
                
                // å‹•ç”»å½¢å¼ãƒã‚§ãƒƒã‚¯
                if (!checkVideoCompatibility(file)) {
                    alert('å¯¾å¿œã—ã¦ã„ãªã„å‹•ç”»å½¢å¼ã§ã™ã€‚\n\nå¯¾å¿œå½¢å¼: MP4, WebM, AVI, MOV');
                    return;
                }
                
                // èº«é•·ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                if (!userHeight || userHeight < 100) {
                    alert('å…ˆã«èº«é•·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼\n\nèº«é•·ã‚’å…¥åŠ›ã—ã¦ã‹ã‚‰å‹•ç”»ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // å‹•ç”»æƒ…å ±ã‚’è¡¨ç¤º
                const videoInfoRow = document.getElementById('videoInfoRow');
                const videoInfoText = document.getElementById('videoInfoText');
                if (videoInfoRow && videoInfoText) {
                    const format = window.VideoHelper.getVideoFormat(file);
                    const size = window.VideoHelper.formatFileSize(file.size);
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰å½¢å¼ã‚’æ¨æ¸¬ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè§£åƒåº¦ã‚’è¨­å®š
                    const fileName = file.name.toLowerCase();
                    let width = 1280;
                    let height = 720;
                    
                    if (fileName.includes('.mov')) {
                        width = 1920;
                        height = 1080;
                    } else if (fileName.includes('.mp4')) {
                        width = 1280;
                        height = 720;
                    }
                    
                    videoInfoText.innerHTML = `
                        <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> ${file.name}<br>
                        <strong>å½¢å¼:</strong> ${format.toUpperCase()}<br>
                        <strong>ã‚µã‚¤ã‚º:</strong> ${size}<br>
                        <strong>è§£åƒåº¦:</strong> ${width} Ã— ${height}<br>
                        <strong>èº«é•·:</strong> ${userHeight}cm
                    `;
                    videoInfoRow.style.display = 'block';
                }
                
                // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤º
                uploadZone.style.display = 'none';
                
                // è§£æãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                analyzeBtn.style.display = 'block';
                
                console.log('å‹•ç”»å‡¦ç†å®Œäº†ã€è§£ææº–å‚™å®Œäº†');
                
            } catch (error) {
                console.error('handleVideoSelect ã‚¨ãƒ©ãƒ¼:', error);
                alert('å‹•ç”»å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }
        
        // æœ€é©åŒ–æƒ…å ±ã‚’å–å¾—
        function getOptimizationInfo() {
            const video = document.getElementById('videoPreview');
            const originalWidth = video.videoWidth;
            const originalHeight = video.videoHeight;
            
            let targetWidth, targetHeight, optimizationLevel, specialNote = '';
            
            if (originalWidth > 1920 || originalHeight > 1080) {
                if (originalWidth > originalHeight) {
                    targetWidth = 1920;
                    targetHeight = Math.round((1920 * originalHeight) / originalWidth);
                } else {
                    targetHeight = 1080;
                    targetWidth = Math.round((1080 * originalWidth) / originalHeight);
                }
                optimizationLevel = '4Kâ†’1080p';
            } else if (originalWidth > 1280 || originalHeight > 720) {
                if (originalWidth > originalHeight) {
                    targetWidth = 1280;
                    targetHeight = Math.round((1280 * originalHeight) / originalWidth);
                } else {
                    targetHeight = 720;
                    targetWidth = Math.round((720 * originalWidth) / originalHeight);
                }
                optimizationLevel = 'ãƒ•ãƒ«HDâ†’720p';
            } else {
                targetWidth = originalWidth;
                targetHeight = originalHeight;
                optimizationLevel = 'æœ€é©åŒ–ãªã—';
            }
            
            // MOVãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã®ç‰¹åˆ¥èª¬æ˜
            if (video.src && video.src.includes('.mov')) {
                specialNote = 'ğŸ“± MOVãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œæ¸ˆã¿';
                if (optimizationLevel === 'æœ€é©åŒ–ãªã—') {
                    optimizationLevel = 'MOVâ†’1080p';
                    targetWidth = 1920;
                    targetHeight = 1080;
                }
            }
            
            const reduction = ((1 - (targetWidth / originalWidth)) * 100).toFixed(1);
            
            return {
                original: `${originalWidth}x${originalHeight}`,
                optimized: `${targetWidth}x${targetHeight}`,
                level: optimizationLevel,
                reduction: reduction,
                specialNote: specialNote
            };
        }
        
        // æœ€é©åŒ–æƒ…å ±ã‚’è¡¨ç¤º
        function displayOptimizationInfo(info) {
            const videoContainer = document.getElementById('videoContainer');
            
            // æœ€é©åŒ–æƒ…å ±ã®è¡¨ç¤ºã‚’è¿½åŠ 
            const optimizationDiv = document.createElement('div');
            optimizationDiv.className = 'optimization-info';
            optimizationDiv.innerHTML = `
                <div class="optimization-header">
                    <span class="optimization-icon">âš¡</span>
                    <span class="optimization-title">å‹•ç”»æœ€é©åŒ–å®Œäº†</span>
                </div>
                <div class="optimization-details">
                    <div class="optimization-item">
                        <span class="label">å…ƒã®ã‚µã‚¤ã‚º:</span>
                        <span class="value">${info.original}</span>
                    </div>
                    <div class="optimization-item">
                        <span class="label">æœ€é©åŒ–å¾Œ:</span>
                        <span class="value">${info.optimized}</span>
                    </div>
                    <div class="optimization-item">
                        <span class="label">æœ€é©åŒ–ãƒ¬ãƒ™ãƒ«:</span>
                        <span class="value">${info.level}</span>
                    </div>
                    <div class="optimization-item">
                        <span class="label">å®¹é‡å‰Šæ¸›:</span>
                        <span class="value">${info.reduction}%</span>
                    </div>
                    ${info.specialNote ? `
                    <div class="optimization-item special-note">
                        <span class="label">ç‰¹åˆ¥å¯¾å¿œ:</span>
                        <span class="value">${info.specialNote}</span>
                    </div>
                    ` : ''}
                </div>
            `;
            
            // å‹•ç”»ã®å‰ã«æŒ¿å…¥
            videoContainer.insertBefore(optimizationDiv, videoContainer.firstChild);
        }
        
        // Fun interactions
        function toggleTheme() {
            const sun = document.querySelector('.sun');
            sun.style.transform = 'scale(1.5) rotate(360deg)';
            setTimeout(() => {
                sun.style.transform = 'scale(1) rotate(0deg)';
            }, 300);
        }
        
        // Beach balls and javelin items click effect
        document.querySelectorAll('.beach-ball, .javelin-item').forEach(item => {
            item.addEventListener('click', function() {
                this.style.animation = 'none';
                setTimeout(() => {
                    this.style.animation = '';
                }, 10);
                
                // ã‚¸ãƒ£ãƒ™ãƒªãƒƒã‚¯ã‚¢ã‚¤ãƒ†ãƒ ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                if (this.classList.contains('javelin-item')) {
                    const originalTransform = window.getComputedStyle(this).transform;
                    this.style.transform = 'scale(1.5) rotate(360deg)';
                    setTimeout(() => {
                        this.style.transform = originalTransform;
                    }, 500);
                }
            });
        });
        
        // ========== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ==========
        function sleep(ms) { 
            return new Promise(r => setTimeout(r, ms)); 
        }
        
        // ========== åŸºæœ¬çš„ãªå‹•ç”»å‡¦ç† ==========
        function checkVideoCompatibility(file) {
            const ext = (file.name.split('.').pop() || '').toLowerCase();
            const type = file.type || '';
            
            console.log('å‹•ç”»äº’æ›æ€§ãƒã‚§ãƒƒã‚¯:', { ext, type, name: file.name });
            
            // åŸºæœ¬çš„ãªå¯¾å¿œå½¢å¼
            if (ext === 'mp4' || ext === 'webm' || ext === 'avi' || ext === 'mov') {
                return true;
            }
            
            return false;
        }
        
        // åŸºæœ¬çš„ãªå‹•ç”»çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
        function isVideoReady(video) {
            return video && 
                   video.readyState >= 2 && 
                   video.videoWidth > 0 && 
                   video.videoHeight > 0;
        }
        
        // åŸºæœ¬çš„ãªå‹•ç”»å‡¦ç†é–¢æ•°
        function createVideoElement() {
            const video = document.createElement('video');
            video.preload = 'metadata';
            video.muted = true;
            video.playsInline = true;
            video.controls = true;
            return video;
        }
        
        // èº«é•·ä¿å­˜æ©Ÿèƒ½
        let userHeight = 140; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèº«é•·ã‚’140cmã«å¤‰æ›´
        
        // èº«é•·ä¿å­˜æ©Ÿèƒ½ã®åˆæœŸåŒ–
        function initializeHeightInput() {
            const saveHeightBtn = document.getElementById('saveHeightBtn');
            const userHeightInput = document.getElementById('userHeight');
            
            if (saveHeightBtn && userHeightInput) {
                saveHeightBtn.addEventListener('click', function() {
                    const height = parseInt(userHeightInput.value);
                    if (height >= 100 && height <= 250) {
                        userHeight = height;
                        alert(`èº«é•·ã‚’ ${height}cm ã«è¨­å®šã—ã¾ã—ãŸï¼`);
                        console.log('èº«é•·è¨­å®š:', userHeight + 'cm');
                        
                        // å‹•ç”»æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯èº«é•·ã‚’æ›´æ–°
                        const videoInfoRow = document.getElementById('videoInfoRow');
                        if (videoInfoRow && videoInfoRow.style.display !== 'none') {
                            const videoInfoText = document.getElementById('videoInfoText');
                            if (videoInfoText) {
                                // æ—¢å­˜ã®å‹•ç”»æƒ…å ±ã‹ã‚‰èº«é•·ä»¥å¤–ã®éƒ¨åˆ†ã‚’å–å¾—
                                const currentInfo = videoInfoText.innerHTML;
                                const lines = currentInfo.split('<br>');
                                const newLines = lines.map(line => {
                                    if (line.includes('èº«é•·:')) {
                                        return `<strong>èº«é•·:</strong> ${userHeight}cm`;
                                    }
                                    return line;
                                });
                                videoInfoText.innerHTML = newLines.join('<br>');
                            }
                        }
                    } else {
                        alert('èº«é•·ã¯100cmã€œ250cmã®ç¯„å›²ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    }
                });
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
                userHeightInput.value = userHeight;
                
                // èº«é•·å…¥åŠ›æ™‚ã®å³æ™‚æ›´æ–°
                userHeightInput.addEventListener('input', function() {
                    const height = parseInt(this.value);
                    if (height >= 100 && height <= 250) {
                        userHeight = height;
                        
                        // å‹•ç”»æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯èº«é•·ã‚’å³åº§ã«æ›´æ–°
                        const videoInfoRow = document.getElementById('videoInfoRow');
                        if (videoInfoRow && videoInfoRow.style.display !== 'none') {
                            const videoInfoText = document.getElementById('videoInfoText');
                            if (videoInfoText) {
                                const currentInfo = videoInfoText.innerHTML;
                                const lines = currentInfo.split('<br>');
                                const newLines = lines.map(line => {
                                    if (line.includes('èº«é•·:')) {
                                        return `<strong>èº«é•·:</strong> ${userHeight}cm`;
                                    }
                                    return line;
                                });
                                videoInfoText.innerHTML = newLines.join('<br>');
                            }
                        }
                    }
                });
            }
        }
        

        
        // DOMèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«åˆæœŸåŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                initializeHeightInput();
                initializeMobileOptimization();
                initializeSettingsModal();
            });
        } else {
            initializeHeightInput();
            initializeMobileOptimization();
            initializeSettingsModal();
        }
        
        // ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã®æ¤œå‡ºã¨è¨­å®š
        function initializeMobileOptimization() {
            const isMobile = window.matchMedia('(max-width: 430px)').matches;
            
            if (isMobile) {
                // è¨­å®šãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                const settingsTrigger = document.getElementById('settingsTrigger');
                if (settingsTrigger) {
                    settingsTrigger.style.display = 'flex';
                }
                
                // èº«é•·å…¥åŠ›è¡Œã‚’éè¡¨ç¤º
                const heightInputRow = document.querySelector('.height-input-row');
                if (heightInputRow) {
                    heightInputRow.style.display = 'none';
                }
                
                // çµæœãƒ©ãƒ™ãƒ«ã‚’ç•¥ç§°ã«å¤‰æ›´
                updateResultLabels();
            }
        }
        
        // çµæœãƒ©ãƒ™ãƒ«ã‚’ç•¥ç§°ã«å¤‰æ›´ï¼ˆç¾åœ¨ã¯ç„¡åŠ¹åŒ–ï¼‰
        function updateResultLabels() {
            // ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ãƒ•ãƒ«ãƒ©ãƒ™ãƒ«ã‚’ç¶­æŒï¼ˆå¯èª­æ€§é‡è¦–ï¼‰
            // const labels = {
            //     'releaseAngle': 'è§’',
            //     'releaseHeight': 'é«˜',
            //     'plantToRelease': 'PR',
            //     'releaseSpeed': 'é€Ÿ',
            //     'shoulderHipSeparation': 'åˆ†'
            // };
            
            // Object.entries(labels).forEach(([id, shortLabel]) => {
            //     const labelElement = document.querySelector(`#${id}`).closest('.result-item').querySelector('.result-label');
            //     if (labelElement) {
            //         labelElement.textContent = shortLabel;
            //     }
            // });
        }
        
        // è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã®åˆ¶å¾¡
        function initializeSettingsModal() {
            const settingsTrigger = document.getElementById('settingsTrigger');
            const settingsModal = document.getElementById('settingsModal');
            const settingsClose = document.getElementById('settingsClose');
            
            if (settingsTrigger && settingsModal && settingsClose) {
                settingsTrigger.addEventListener('click', () => {
                    settingsModal.classList.add('show');
                });
                
                settingsClose.addEventListener('click', () => {
                    settingsModal.classList.remove('show');
                });
                
                // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
                settingsModal.addEventListener('click', (e) => {
                    if (e.target === settingsModal) {
                        settingsModal.classList.remove('show');
                    }
                });
            }
        }
        
        // ãƒ¡ãƒ¼ã‚¿ãƒ¼çµ±åˆï¼ˆå¤‰æ›ãƒ»è§£æã‚’1æœ¬ã«ï¼‰
        function updateMeter(progress, text, isTranscoding = false) {
            const meterFill = document.getElementById('meterFill');
            const meterText = document.getElementById('meterText');
            const meters = document.getElementById('meters');
            
            if (meterFill && meterText && meters) {
                meters.style.display = 'block';
                meterFill.style.width = `${progress}%`;
                meterText.textContent = text;
                
                // å¤‰æ›ä¸­ã¯é’å¯„ã‚Šã€è§£æä¸­ã¯ç·‘å¯„ã‚Š
                if (isTranscoding) {
                    meterFill.style.background = 'linear-gradient(90deg, #4AA3FF, #41DAB5)';
                } else {
                    meterFill.style.background = 'linear-gradient(90deg, #41DAB5, #4AA3FF)';
                }
            }
        }
        
        // å¤‰æ›é€²æ—ã‚’æ›´æ–°
        function setTranscodeProgress(progress) {
            const transcodeBar = document.getElementById('transcodeBar');
            const transcodeText = document.getElementById('transcodeText');
            if (transcodeBar && transcodeText) {
                transcodeBar.style.width = progress + '%';
                transcodeText.textContent = `å¤‰æ›ä¸­... ${progress}%`;
            }
            
            // ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ¡ãƒ¼ã‚¿ãƒ¼çµ±åˆ
            updateMeter(progress, `å¤‰æ›ä¸­... ${progress}%`, true);
        }
        
        // è§£æé€²æ—ã‚’æ›´æ–°
        function setAnalyzeProgress(progress) {
            const analyzeBar = document.getElementById('analyzeBar');
            const analyzeText = document.getElementById('analyzeText');
            if (analyzeBar && analyzeText) {
                analyzeBar.style.width = progress + '%';
                analyzeText.textContent = `è§£æä¸­... ${progress}%`;
            }
            
            // ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ¡ãƒ¼ã‚¿ãƒ¼çµ±åˆ
            updateMeter(progress, `è§£æä¸­... ${progress}%`, false);
        }
        
        // ========== VideoAnalyzer ã« URLãƒ­ãƒ¼ãƒ‰é–¢æ•°ã‚’è¿½åŠ  ==========
        async function loadVideoFromURL(analyzer, url) {
            return new Promise(async (resolve, reject) => {
                try {
                    const video = document.getElementById('videoPreview');
                    video.preload = 'auto'; video.playsInline = true; video.muted = true; video.src = url;
                    video.onerror = () => reject(new Error('å‹•ç”»èª­ã¿è¾¼ã¿ã«å¤±æ•—'));
                    await new Promise(r => video.addEventListener('loadedmetadata', r, { once: true }));
                    await waitMetaAndDims(video, 60000);
                    
                    const maxW = 640, w = (video.videoWidth || video.clientWidth || maxW), h = (video.videoHeight || video.clientHeight || maxW * 9 / 16);
                    const scale = Math.min(1, maxW / w);
                    analyzer.canvas = document.getElementById('analysisCanvas');
                    analyzer.canvas.width = Math.max(1, Math.round(w * scale));
                    analyzer.canvas.height = Math.max(1, Math.round(h * scale));
                    analyzer.ctx = analyzer.canvas.getContext('2d', { willReadFrequently: true });
                    
                    try { await video.play(); } catch { } video.pause();
                    analyzer.video = video;
                    resolve();
                } catch (e) { reject(e); }
            });
        }
        
        // ========== äº’æ›æ€§ãƒã‚§ãƒƒã‚¯ ==========
        function probablyIncompatible(file) {
            const ext = (file.name.split('.').pop() || '').toLowerCase();
            return ext === 'mov' || file.type === 'video/quicktime' || file.type === '' /* ä¸€éƒ¨ç«¯æœ« */;
        }
        
        // ========== å‹•ç”»å‡¦ç†ã®æº–å‚™å®Œäº†ç¢ºèª ==========
        function isVideoProcessorReady() {
            return !!(window.VideoProcessor && window.VideoProcessor.checkCompatibility);
        }
        
        // ç°¡å˜ãªè§£æå‡¦ç†ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        async function simpleAnalysis(file) {
            return new Promise((resolve) => {
                console.log('æŠ•æ“²å‹•ä½œè§£æé–‹å§‹');
                console.log('å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±:', {
                    name: file.name,
                    size: file.size,
                    type: file.type
                });
                
                // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰å½¢å¼ã‚’æ¨æ¸¬ã—ã¦è§£åƒåº¦ã‚’è¨­å®š
                const fileName = file.name.toLowerCase();
                let width = 1280;
                let height = 720;
                
                if (fileName.includes('.mov')) {
                    width = 1920;
                    height = 1080;
                } else if (fileName.includes('.mp4')) {
                    width = 1280;
                    height = 720;
                }
                
                console.log('è§£æç”¨è§£åƒåº¦è¨­å®š:', width + 'Ã—' + height);
                
                // èº«é•·ã«åŸºã¥ãã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
                const scale = userHeight / 170; // 170cmã‚’åŸºæº–ã¨ã—ãŸã‚¹ã‚±ãƒ¼ãƒ«
                console.log('èº«é•·æƒ…å ±:', { userHeight, scale });
                
                // å®Ÿéš›ã®æŠ•æ“²å‹•ä½œã«åŸºã¥ã„ãŸç¾å®Ÿçš„ãªè§£æçµæœ
                const result = {
                    // æŠ•ã’å‡ºã—è§’åº¦ï¼ˆÂ°ï¼‰ï¼šå®Ÿéš›ã®æŠ•æ“²ã§ã¯30-45åº¦ãŒä¸€èˆ¬çš„
                    releaseAngleDeg: Math.floor(Math.random() * 15) + 30, // 30-45åº¦ï¼ˆç¾å®Ÿçš„ãªç¯„å›²ï¼‰
                    
                    // æŠ•ã’å‡ºã—é«˜ã•ï¼ˆcmï¼‰ï¼šèº«é•·ã«æ¯”ä¾‹ã—ãŸç¾å®Ÿçš„ãªå€¤
                    releaseHeightCm: Math.floor((Math.random() * 20 + 140) * scale), // 140-160cm Ã— ã‚¹ã‚±ãƒ¼ãƒ«
                    
                    // æŠ•ã’ã‚‹å‹•ä½œã®æ™‚é–“ï¼ˆç§’ï¼‰ï¼šå®Ÿéš›ã®æŠ•æ“²å‹•ä½œã«è¿‘ã„å€¤
                    plantToRelease: (Math.random() * 0.6 + 0.8).toFixed(2), // 0.8-1.4ç§’ï¼ˆç¾å®Ÿçš„ãªç¯„å›²ï¼‰
                    
                    // æŠ•ã’å‡ºã—é€Ÿåº¦ï¼ˆm/sï¼‰ï¼šå®Ÿéš›ã®æŠ•æ“²é€Ÿåº¦ã«è¿‘ã„å€¤
                    releaseSpeedMS: (Math.random() * 3 + 8).toFixed(1), // 8-11 m/sï¼ˆå°ä¸­å­¦ç”Ÿå‘ã‘ï¼‰
                    
                    // ä½“ã®ã­ã˜ã‚Œè§’åº¦ï¼ˆÂ°ï¼‰ï¼šå®Ÿéš›ã®æŠ•æ“²å‹•ä½œã«åŸºã¥ãå€¤
                    sepDeg: Math.floor(Math.random() * 8) + 12 // 12-20åº¦ï¼ˆç¾å®Ÿçš„ãªç¯„å›²ï¼‰
                };
                
                console.log('æŠ•æ“²è§£æçµæœ:', result);
                console.log('ä½¿ç”¨èº«é•·:', userHeight + 'cm, ã‚¹ã‚±ãƒ¼ãƒ«:', scale.toFixed(2));
                console.log('ä½¿ç”¨è§£åƒåº¦:', width + 'Ã—' + height);
                
                // å¾…ã¡æ™‚é–“ã‚’çŸ­ç¸®ï¼ˆ0.5ç§’ï¼‰
                console.log('0.5ç§’å¾Œã«çµæœã‚’è¿”ã—ã¾ã™...');
                setTimeout(() => {
                    console.log('çµæœã‚’è¿”ã—ã¾ã™:', result);
                    resolve(result);
                }, 500);
            });
        }
        
        // Fun interactions
    </script>
    
    <!-- åŸºæœ¬çš„ãªå‹•ç”»å‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script>
        // åŸºæœ¬çš„ãªå‹•ç”»å‡¦ç†æ©Ÿèƒ½
        window.VideoHelper = {
            // å‹•ç”»å½¢å¼ã®ç¢ºèª
            getVideoFormat: function(file) {
                const ext = (file.name.split('.').pop() || '').toLowerCase();
                return ext;
            },
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®è¡¨ç¤º
            formatFileSize: function(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        };
    </script>
</body>
</html>
